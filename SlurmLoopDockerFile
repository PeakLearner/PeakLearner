FROM ubuntu as setup
ENV TZ="America/Phoenix"
# Prereqs
RUN apt-get update
RUN apt-get -y install dialog apt-utils ca-certificates
RUN DEBIAN_FRONTEND="noninteractive" apt-get -y install tzdata

# R Prereqs
RUN apt-get install -y dirmngr gnupg apt-transport-https ca-certificates software-properties-common
RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9 && add-apt-repository 'deb https://cloud.r-project.org/bin/linux/ubuntu focal-cran40/'
RUN apt-get update
RUN apt-get install -y git r-base python3 python3-pip
# R Setup
RUN Rscript -e 'install.packages("data.table")'

# UCSC Binary
RUN mkdir /build/
WORKDIR /build/
RUN mkdir bin/
ADD http://hgdownload.soe.ucsc.edu/admin/exe/linux.x86_64.v385/bigWigToBedGraph bin/
RUN chmod a+x bin/bigWigToBedGraph
COPY slurmRequirements.txt .
RUN python3 -m pip install -U pip && \
    python3 -m pip install -r slurmRequirements.txt
COPY ./Slurm ./Slurm
CMD ["./Slurm/runLoop.sh"]